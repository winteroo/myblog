(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{377:function(t,s,a){t.exports=a.p+"assets/img/eventLoop.a4f1ce3f.png"},483:function(t,s,a){"use strict";a.r(s);var n=a(18),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"js事件循环-event-loop"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#js事件循环-event-loop"}},[t._v("#")]),t._v(" JS事件循环(Event Loop)")]),t._v(" "),n("h2",{attrs:{id:"为什么javascript是单线程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么javascript是单线程"}},[t._v("#")]),t._v(" 为什么JavaScript是单线程")]),t._v(" "),n("p",[t._v("JavaScript语言的一大特点就是"),n("strong",[t._v("单线程")]),t._v("，即同一时间内，JavaScript只能做一件事。")]),t._v(" "),n("p",[t._v("其实，JavaScript的单线程特点和它的用途是有关系的，试想，如果JavaScript是多线程的，此时有两个线程，一个线程修改\n某个DOM元素的内容，有一个线程又去删除这个DOM，那么这时浏览器就不知道该怎么办了，造成不必要的混淆。")]),t._v(" "),n("p",[t._v("所以，为了避免复杂，JavaScript做成单线程语言，这样就很清晰了。")]),t._v(" "),n("h2",{attrs:{id:"任务队列"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#任务队列"}},[t._v("#")]),t._v(" 任务队列")]),t._v(" "),n("p",[t._v("因为JavaScript的单线程机制，这就意味着所有的任务都必须排队执行，前一个任务执行完成，后一个任务才会执行，如果此时\n队列中有一个非常耗时的操作，后一个任务就不得不持续等待。")]),t._v(" "),n("p",[t._v("但是JavaScript设计者不会允许这样的事情发生，所以JavaScript会将异步事件挂在与当前执行栈不同的队列中，这个队列我们称之为"),n("strong",[t._v("任务队列")]),t._v("。")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("执行栈")]),t._v(" "),n("p",[t._v("JavaScript主线程执行时，会从执行栈顶取出一个任务执行，执行完后再取任务执行，周而复始。")])]),t._v(" "),n("h2",{attrs:{id:"任务分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#任务分类"}},[t._v("#")]),t._v(" 任务分类")]),t._v(" "),n("p",[t._v("在JavaScript中，我们将全部的任务分为两种：同步任务和异步任务。")]),t._v(" "),n("p",[t._v("异步任务又分为"),n("strong",[t._v("宏任务")]),t._v("和"),n("strong",[t._v("微任务")])]),t._v(" "),n("ul",[n("li",[t._v("宏任务(macrotask):一些异步任务的回调函数会依次进入宏任务队列（macro task queue），这些异步任务包括：\n"),n("ul",[n("li",[n("strong",[t._v("setTimeout")])]),t._v(" "),n("li",[n("strong",[t._v("setInterval")])]),t._v(" "),n("li",[n("strong",[t._v("setImmediate (Node独有)")])]),t._v(" "),n("li",[n("strong",[t._v("requestAnimationFrame (浏览器独有)")])]),t._v(" "),n("li",[n("strong",[t._v("I/O")])]),t._v(" "),n("li",[n("strong",[t._v("UI rendering (浏览器独有)")])])])]),t._v(" "),n("li",[t._v("微任务（microtask）：另一些异步任务的回调函数会依次进入宏任务队列（micro task queue）,包括:\n"),n("ul",[n("li",[t._v("process.nextTick (Node独有)")]),t._v(" "),n("li",[t._v("Promise.then")]),t._v(" "),n("li",[t._v("Object.observe")]),t._v(" "),n("li",[t._v("MutationObserver")])])])]),t._v(" "),n("h2",{attrs:{id:"event-loop"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#event-loop"}},[t._v("#")]),t._v(" Event Loop")]),t._v(" "),n("p",[t._v("先来看一张图：\n"),n("img",{attrs:{src:a(377),alt:"eventLoop"}})]),t._v(" "),n("hr"),t._v(" "),n("p",[t._v("这张图将浏览器的event loop完整的流程描述了出来，具体如下：")]),t._v(" "),n("ol",[n("li",[t._v("执行全局Script同步代码，这些同步代码有一些是同步语句，有一些是异步语句（比如setTimeout等）；")]),t._v(" "),n("li",[t._v("全局Script代码执行完毕后，调用栈Stack会清空；")]),t._v(" "),n("li",[t._v("从微队列microtask queue中取出位于队首的回调任务，放入调用栈Stack中执行，执行完后microtask queue长度减1；")]),t._v(" "),n("li",[t._v("继续取出位于队首的任务，放入调用栈Stack中执行，以此类推，直到直到把microtask queue中的所有任务都执行完毕。注意，如果在执行microtask的过程中，又产生了microtask，那么会加入到队列的末尾，也会在这个周期被调用执行；")]),t._v(" "),n("li",[t._v("microtask queue中的所有任务都执行完毕，此时microtask queue为空队列，调用栈Stack也为空；")]),t._v(" "),n("li",[t._v("取出宏队列macrotask queue中位于队首的任务，放入Stack中执行；")]),t._v(" "),n("li",[t._v("执行完毕后，调用栈Stack为空；")]),t._v(" "),n("li",[t._v("重复第3-7个步骤；")])]),t._v(" "),n("p",[t._v("......")]),t._v(" "),n("hr"),t._v(" "),n("h2",{attrs:{id:"面试题详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#面试题详解"}},[t._v("#")]),t._v(" 面试题详解")]),t._v(" "),n("p",[t._v("题目：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("reject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("val")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("分析")]),t._v(" "),n("ol",[n("li",[t._v("执行script")]),t._v(" "),n("li",[t._v("第一行遇到setTimeout，宏任务，放到宏任务队列中，继续执行")]),t._v(" "),n("li",[t._v("第4行遇到promise，promise里面的任务是同步任务，是立即执行的，所以打印2，并执行resolve")]),t._v(" "),n("li",[t._v("第七行，遇到then，微任务，放到微任务队列中，继续执行")]),t._v(" "),n("li",[t._v("第十行，遇到打印语句，同步任务，直接执行打印4，")]),t._v(" "),n("li",[t._v("此时，执行栈空了，JavaScript开始从微任务队列中依次取出微任务压入执行栈中执行，打印3")]),t._v(" "),n("li",[t._v("微任务队列空了，JavaScript开始从宏任务队列中依次取出宏任务压入执行栈中执行，打印1.\n所以最终结果是2，4，3，1")])])]),t._v(" "),n("p",[n("strong",[t._v("如果你感觉本文章对你有帮助，欢迎 "),n("a",{attrs:{href:"https://github.com/winteroo/myblog",target:"_blank",rel:"noopener noreferrer"}},[t._v("Star"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);